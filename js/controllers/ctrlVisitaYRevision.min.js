
$(document).ready(function(){var a=$.Callbacks();a.add(onLoad());a.add(getRecordsVYR);a.fire()});function onLoad(){$("#ExistenObservaciones").on("change",function(a){console.log($("#ExistenObservaciones").val());$("#btnRegistrarVisitaYRevision").removeClass("disabled");if($("#fObservaciones").hasClass("hide")&&$("#ExistenObservaciones").val()==="1"){$("#fObservaciones").removeClass("hide")}else{$("#fObservaciones").addClass("hide")}});$("#btnAgregarVisitaYRevision").on("click",function(){$("#frmVisitaYRevision")[0].reset();$("#nIdSesion").parent("div").addClass("hide");$("#btnRegistrarVisitaYRevision").addClass("disabled");$("#IdSesion").parent("div").removeClass("hide");if($("#btnRegistrarVisitaYRevision").hasClass("hide")){$("#btnRegistrarVisitaYRevision").removeClass("hide");$("#btnActualizarVisitaYRevision").addClass("hide")}$("#fObservaciones").addClass("hide")});$("#btnRegistrarVisitaYRevision").on("click",function(){onAddRecordVYR();$("#mdlNuevaVisitaYRevision").modal("toggle")});$("#btnReCargarVisitaYRevisions").on("click",function(){getRecordsVYR()});$("#btnEditarVisitaYRevision").on("click",function(){onBeforeUpdateVYR()});$("#btnActualizarVisitaYRevision").on("click",function(){onUpdateVYR()});$("#btnEliminarVisitaYRevision").on("click",function(){onDeleteVYR()});getCitas("IdSesion")}function getRecordsVYR(){temp=null;$.ajax({url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",type:"POST",dataType:"JSON",data:{indice:1},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(c){var a="tblVisitaYRevision";$("#rVisitaYRevision").html(getTable(a,c));if(c.length>0){var b=$("#"+a).DataTable(tableOptions);$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("success");$("#"+a).find("tr").removeClass("warning");var f=this.id;var d=$.inArray(f,selected);if(d===-1){selected.push(f)}else{selected.splice(d,1)}$(this).addClass("success");var e=b.row(this).data();temp=parseInt(e[0])});$("#"+a+" tbody").on("dblclick","tr",function(){$("#"+a).find("tr").removeClass("warning");$(this).addClass("warning");var d=b.row(this).data();temp=parseInt(d[0]);console.log("TEMPORAL: "+temp);onBeforeUpdateVYR()})}else{$("#msgVisitaYRevision").html('<div class="alert alert-dismissible alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong><h1 class="text-center">NO EXISTEN REGISTROS DISPONIBLES</h1></a></div>')}})}function getCitas(a){$.ajax({url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",type:"POST",dataType:"JSON",data:{indice:2},error:function(b,d,c){console.log(c);console.log(d)}}).done(function(c){if(c!==undefined&&c!==null&&c.length>0){var b="<option></option>";$.each(c,function(e,d){b+='<option value="'+d.ID+'" >'+d.ACTIVIDAD+", "+d.CLIENTE+", "+d.FECHA+"</option>"});$("#"+a).html(b)}else{$("#"+a).prop("readonly")}})}function onAddRecordVYR(){var a=$("#frmVisitaYRevision").serialize();$.ajax({type:"POST",url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",data:a+"&indice="+3,success:function(b){if(b!==undefined&&b!==null&&b.length>0){$("#mdlNuevaVisitaYRevision").modal("hide");$("#msgVisitaYRevision").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><h1>REGISTRO AGREGADO CORRECTAMENTE</h1></a></div>')}getRecordsVYR();$("#frmVisitaYRevision")[0].reset();if($("#btnActualizarVisitaYRevision").hasClass("hide")){$("#btnActualizarVisitaYRevision").removeClass("hide");$("#btnRegistrarVisitaYRevision").addClass("hide")}else{$("#btnActualizarVisitaYRevision").addClass("hide");$("#btnRegistrarVisitaYRevision").removeClass("hide")}},error:function(b,d,c){console.log(c);console.log(d)}})}function onUpdateVYR(){var a=$("#frmVisitaYRevision").serialize();$.ajax({type:"POST",url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",data:a+"&indice="+8,success:function(b){if(b!==undefined&&b!==null&&b.length>0){$("#mdlNuevaVisitaYRevision").modal("hide");$("#msgVisitaYRevision").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><h1>REGISTRO ACTUALIZADO CORRECTAMENTE</h1></a></div>')}getRecordsVYR();$("#fVisitaYRevision")[0].reset();if($("#btnActualizarVisitaYRevision").hasClass("hide")){$("#btnActualizarVisitaYRevision").removeClass("hide");$("#btnRegistrarVisitaYRevision").addClass("hide")}else{$("#btnActualizarVisitaYRevision").addClass("hide");$("#btnRegistrarVisitaYRevision").removeClass("hide")}},error:function(b,d,c){console.log(c);console.log(d)}})}function onBeforeUpdateVYR(){if(temp!==undefined&&temp!==null&&temp!==0&&temp!==""){console.log("TEMP: "+temp);$("#mdlNuevaVisitaYRevision").modal("toggle");$.ajax({url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",type:"POST",dataType:"JSON",data:{indice:7,ID:temp},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){console.log(a);status_document="u";$("#IdSesion").parent("div").addClass("hide");if($("#nIdSesion").parent("div").hasClass("hide")){$("#nIdSesion").parent("div").removeClass("hide");$("#nIdSesion").val(a[0].ID)}$("#IdSesion").val(a[0].SESION);$("#ExistenObservaciones").val(a[0].OBSERVACIONES==="SI"?1:0);$("#uIdSesion").val(a[0].SESION);$("#uExistenObservaciones").val(a[0].OBSERVACIONES==="SI"?1:0);if(a[0].OBSERVACIONES==="SI"){$("#fObservaciones").removeClass("hide");$("#ObservacionesVisita").val(a[0].OBSERVACIONESVISITA);$("#Seguimiento").val(a[0].SEGUIMIENTO);$("#uObservacionesVisita").val(a[0].OBSERVACIONESVISITA);$("#uSeguimiento").val(a[0].SEGUIMIENTO)}else{$("#fObservaciones").addClass("hide")}});if($("#btnActualizarVisitaYRevision").hasClass("hide")){$("#btnActualizarVisitaYRevision").removeClass("hide");$("#btnRegistrarVisitaYRevision").addClass("hide")}else{}setFormSuccess()}else{$("#mdlMessages").modal("toggle")}}function onDeleteVYR(){if(temp!==0&&temp!==undefined&&temp!==null){$.ajax({url:base_url+"index.php/ctrlVisitaYRevision/onLoadVisitaYRevision",type:"POST",data:{indice:4,ID:temp},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){console.log(a);if(parseInt(a)===1){$("#msgVisitaYRevision").fadeIn(100);$("#msgVisitaYRevision").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><strong><h1 class="text-center">REGISTRO ELIMINADO</h1></a></div>')}temp=null;getRecordsVYR()})}else{$("#mdlMessages").modal("toggle")}}var form="frmVisitaYRevision";function setFormSuccess(){$("#"+form+" input, #"+form+" select").each(function(b){var a=$(this);$("#"+a.attr("id")).parent("div").removeClass("has-warning");$("#"+a.attr("id")).parent("div").removeClass("has-error");$("#"+a.attr("id")).parent("div").addClass("has-success")})}function setFormWarning(){$("#"+form+" input, #"+form+" select").each(function(b){var a=$(this);$("#"+a.attr("id")).parent("div").removeClass("has-success");$("#"+a.attr("id")).parent("div").removeClass("has-error");$("#"+a.attr("id")).parent("div").addClass("has-warning")})}function setFormDanger(){$("#"+form+" input, #"+form+" select").each(function(b){var a=$(this);$("#"+a.attr("id")).parent("div").removeClass("has-success");$("#"+a.attr("id")).parent("div").removeClass("has-warning");$("#"+a.attr("id")).parent("div").addClass("has-error")})};