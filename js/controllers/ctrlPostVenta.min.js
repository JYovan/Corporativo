
$(document).ready(function(a){getPV();$("#btnAgregarPostVenta").on("click",function(){$("#fRegistroCita")[0].reset();if($("#btnRegistrarPostVenta").hasClass("hide")){$("#btnRegistrarPostVenta").removeClass("hide");$("#btnActualizarPostVenta").addClass("hide")}});$("#btnEditarPostVenta").on("click",function(){onBeforeUpdatePV()});$("#btnReCargarPostVentas").on("click",function(){getPV();console.log("Desde el boton")});$("#btnEliminarPostVenta").on("click",function(){onDeletePV()});$("#btnExportarPDF").on("click",function(){$("#mdlReporteGeneralCitas").modal("handleUpdate")});$("#mdlReporteGeneralCitas").on("shown.bs.modal",function(){getReporteGeneralDeCitas()});$('a[data-toggle="tab"]').on("shown.bs.tab",function(){getReporteGeneralDeCitasEV();getReporteGeneralDeCitasFE()});$("#cmbCiudad").on("change",function(b){$("#txtIDCiudad").val($("#cmbCiudad").val())});$("#cmbEstado").on("change",function(b){onChangeValueEstate()});$("#btnRegistrarPostVenta").on("click",function(){onAddRecordPV()});$("#btnActualizarPostVenta").on("click",function(){onUpdateRecordPV()})});function getPV(){temp=null;$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:1},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(c){var a="tblPostVenta";$("#rPostVenta").html(getTable(a,c));if(c.length>0){var b=$("#"+a).DataTable(tableOptions);$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("success");$("#"+a).find("tr").removeClass("warning");var f=this.id;var d=$.inArray(f,selected);if(d===-1){selected.push(f)}else{selected.splice(d,1)}$(this).addClass("success");var e=b.row(this).data();temp=parseInt(e[0])});$("#"+a+" tbody").on("dblclick","tr",function(){$("#"+a).find("tr").removeClass("warning");$(this).addClass("warning");var d=b.row(this).data();temp=parseInt(d[0]);onBeforeUpdatePV()})}else{$("#msgPostVenta").html('<div class="alert alert-dismissible alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong><h1 class="text-center">NO EXISTEN REGISTROS DISPONIBLES</h1></a></div>')}})}function getReporteGeneralDeCitas(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:2},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(b){var a="tblReporteGeneralDeCitas";$("#rReporteGeneralDeCitas").html(getTable(a,b));console.log(b);$("#"+a).DataTable(tableOptions);$("#"+a).DataTable().columns.adjust().draw();$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("warning");var d=this.id;var c=$.inArray(d,selected);if(c===-1){selected.push(d)}else{selected.splice(c,1)}$(this).addClass("warning")})})}function getGarantias(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:3},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(b){var a="tblGarantias";$("#rGarantias").html(getTable(a,b));console.log(b);$("#"+a).DataTable(tableOptions);$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("warning");var d=this.id;var c=$.inArray(d,selected);if(c===-1){selected.push(d)}else{selected.splice(c,1)}$(this).addClass("warning")})})}function onDeletePV(){if(temp!==0&&temp!==undefined&&temp!==null){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",data:{indice:4,ID:temp},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){console.log(a);if(parseInt(a)===1){$("#msgPostVenta").fadeIn(100);$("#msgPostVenta").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><strong><h1 class="text-center">REGISTRO '+temp+" ELIMINADO</h1></a></div>")}temp=null;getPV()})}else{$("#mdlMessages").modal("toggle")}}function onChangeValueEstate(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:5,IdEstado:$("#cmbEstado").val()},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(b){if(b!==undefined&&b!==null&&b.length>0){var a="";$.each(b,function(d,c){a+='<option value="'+c.id_ciudad+'" >'+c.dsc_ciudad+"</option>"});$("#cmbCiudad").html(a)}})}function onAddRecordPV(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",data:{indice:6,Actividad:$("#cmbActividad").val(),Fecha:$("#txtFecha").val(),Descripcion:$("#txtDescripcion").val(),Lugar:$("#txtLugar").val(),Calle:$("#txtCalle").val(),Numero:$("#txtNumero").val(),Colonia:$("#txtColonia").val(),IdEstado:$("#cmbEstado").val(),IdCiudad:$("#cmbCiudad").val(),Duracion:$("#txtDuracion").val(),HoraInicio:$("#txtHoraInicio").val(),HoraTermino:$("#txtHoraTermino").val(),Participante:$("#txtParticipante").val(),IdCliente:$("#cmbClientes").val(),Otros:$("#txtOtroParticipante").val(),Notario:$("#txtNotario").val(),NumeroNotario:$("#txtNumeroNotario").val(),Observaciones:$("#txtObservaciones").val()},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){if(a!==undefined&&a!==null&&a.length>0){$("#mdlNuevaPostVenta").modal("hide");$("#msgPostVenta").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><h1>CITA AGREGADA CORRECTAMENTE</h1></a></div>');getPV();$("#fRegistroCita")[0].reset()}})}function onBeforeUpdatePV(){if(temp!==undefined&&temp!==null){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:7,ID:temp},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){console.log(a);$("#cmbActividad").val(a[0].Actividad);$("#txtFecha").val(a[0].Fecha);$("#txtDescripcion").val(a[0].Descripcion);$("#txtLugar").val(a[0].Lugar);$("#txtCalle").val(a[0].Calle);$("#txtNumero").val(a[0].Numero);$("#txtNumero").val(a[0].Numero);$("#txtColonia").val(a[0].Colonia);$("#cmbEstado").trigger("change");$("#cmbEstado").val(a[0].IdEstado);$("#txtIDCiudad").val(a[0].IdCiudad);$("#txtDuracion").val(a[0].Duracion);$("#txtHoraInicio").val(a[0].HoraInicio);$("#txtHoraTermino").val(a[0].HoraTermino);$("#txtParticipante").val(a[0].Participante);$("#cmbClientes").val(a[0].IdCliente);$("#txtOtroParticipante").val(a[0].Otros);$("#txtIDPostVenta").val(a[0].IdPostVenta);$("#txtNotario").val(a[0].Notario);$("#txtNumeroNotario").val(a[0].NumeroNotario);$("#txtObservaciones").val(a[0].Observaciones)});$("#mdlNuevaPostVenta").modal("toggle");if($("#btnActualizarPostVenta").hasClass("hide")){$("#btnActualizarPostVenta").removeClass("hide");$("#btnRegistrarPostVenta").addClass("hide")}else{console.log("no")}}else{$("#mdlMessages").modal("toggle")}}function onUpdateRecordPV(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",data:{indice:8,ID:$("#txtIDPostVenta").val(),Actividad:$("#cmbActividad").val(),Fecha:$("#txtFecha").val(),Descripcion:$("#txtDescripcion").val(),Lugar:$("#txtLugar").val(),Calle:$("#txtCalle").val(),Numero:$("#txtNumero").val(),Colonia:$("#txtColonia").val(),IdEstado:$("#cmbEstado").val(),IdCiudad:$("#txtIDCiudad").val(),Duracion:$("#txtDuracion").val(),HoraInicio:$("#txtHoraInicio").val(),HoraTermino:$("#txtHoraTermino").val(),Participante:$("#txtParticipante").val(),IdCliente:$("#cmbClientes").val(),Otros:$("#txtOtroParticipante").val(),Notario:$("#txtNotario").val(),NumeroNotario:$("#txtNumeroNotario").val(),Observaciones:$("#txtObservaciones").val()},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(a){console.log(a);if(a!==undefined&&a!==null&&a.length>0){$("#mdlNuevaPostVenta").modal("hide");$("#msgPostVenta").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><h1>CITA '+temp+" ACTUALIZADA CORRECTAMENTE</h1></a></div>");getPV();$("#fRegistroCita")[0].reset()}});$("#mdlNuevaPostVenta").modal("hide")}function getReporteGeneralDeCitasEV(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:9},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(b){var a="tblReporteGeneralDeCitasEV";$("#rReporteGeneralDeCitasEV").html(getTable(a,b));console.log(b);$("#"+a).DataTable(tableOptions);$("#"+a).DataTable().columns.adjust().draw();$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("warning");var d=this.id;var c=$.inArray(d,selected);if(c===-1){selected.push(d)}else{selected.splice(c,1)}$(this).addClass("warning")})})}function getReporteGeneralDeCitasFE(){$.ajax({url:base_url+"index.php/ctrlPostVenta/onLoadPostVentas",type:"POST",dataType:"JSON",data:{indice:10},error:function(a,c,b){console.log(b);console.log(c)}}).done(function(b){var a="tblReporteGeneralDeCitasFE";$("#rReporteGeneralDeCitasFE").html(getTable(a,b));console.log(b);$("#"+a).DataTable(tableOptions);$("#"+a).DataTable().columns.adjust().draw();$("#"+a+" tbody").on("click","tr",function(){$("#"+a).find("tr").removeClass("warning");var d=this.id;var c=$.inArray(d,selected);if(c===-1){selected.push(d)}else{selected.splice(c,1)}$(this).addClass("warning")})})};