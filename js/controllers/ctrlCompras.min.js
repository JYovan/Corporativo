
doc="Compras";var tcot=0;var tt=0;var nformat="";var target_messages="mdlMessages";var content_message="NO HA ELEGIDO NINGUN REGISTRO";$(document).ready(function(f){var d=base_url+"index.php/ctrlCompras/";var a=$("#Autoriza");var b=$("#Recibe");var c=$("#Cuenta");onLoad();$("#Proyectos").change(function(){$("#Numero").addClass("hide");$("#Numero").parent().append('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>');$.ajax({url:d+"getNumeroDeCotizacionXProyecto",type:"POST",dataType:"JSON",data:{ID:$("#Proyectos").val()}}).done(function(h,g,i){console.log(h);$("#Numero").removeClass("hide");$("#Numero").next().remove();$("#Numero").val(h[0].COTIZACION)}).fail(function(g,i,h){console.log(g,i,h)}).always(function(){console.log("OPERACION CONCLUIDA")})});$(".btnAddRow").click(function(g){g.preventDefault();if($("#Etiqueta").val()!==undefined&&$("#Etiqueta").val()!==""&&$("#Producto").val()!==undefined&&$("#Producto").val()!==""&&$("#Cantidad").val()!==undefined&&$("#Cantidad").val()!==""){$("#dpbtnAdd").removeClass("hide");$("#dbtnAdd").addClass("hide");$("#Proyectos").attr("readonly",true);$("#Anotaciones").attr("readonly",true);$("#Fecha").attr("readonly",true);$("#Numero").attr("readonly",true);$("#Etiqueta").attr("readonly",true);$("#Proveedores").attr("readonly",true);$("#Producto").attr("readonly",true);$("#Cantidad").attr("readonly",true);$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:3,ID:$("#Producto").val(),ETIQUETAID:$("#Etiqueta").val(),PROVEEDORES:$("#Proveedores").val(),CANTIDAD:$("#Cantidad").val()}}).done(function(i,k,h){var j=i[0];if(j!==undefined){$(".tblCProductos tbody").append('<tr><td class="tdIdPro hide">'+j.IDPROV+"</td><td>"+j.Proveedor+'</td><td class="tdIdProd hide">'+j.IDPROD+'</td><td class="tdIdEti hide">'+j.IDETI+"</td><td>"+j.Producto+" "+j.Marca+"</td><td>"+j.UnidadMedida+'</td><td class="tdCantidad">'+$("#Cantidad").val()+'</td><td class="tdPrecio hide">'+j.Precio+'</td><td class="text-center"><span class="label label-default">$ '+$.number(j.Precio,5,"."," ,")+'</span></td><td class="text-center"><span class="label label-warning">$ '+$.number(j.IMPORTE,5,".",", ")+'</span></td><td class="tdImporte hide">'+j.IMPORTE+'</td><td><button type="button" class="btn btn3d btn-danger btn-lg btnDeleteRow" onclick="onDeleteRow(this,\'thTOTAL\',\'dMessages\')" data-toggle="tooltip" data-placement="top" title="" data-original-title="ELIMINAR" ><span class="fa fa-minus"></span></button> </td><td class="tdEstatus"><span class="label label-emerald">NUEVO</span></td></tr>');tt=tt+($("#Cantidad").val()*j.Precio);$("#thTOTAL").effect("highlight",3000);$("#thTOTAL").html('<div class="col-md-9"></div><span class="label label-default">TOTAL:</span><span class="label label-primary"> $ '+$.number(tt,5,".",", ")+"</span>");$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"PRODUCTO AGREGADO"},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});$("#dMessages").html('<span class="label label-success">EXITO! PRODUCTO AGREGADO</span>');$("#dMessages").effect("pulsate",3000)}else{$("#dMessages").html('<span class="label label-danger">ERROR! EL PRODUCTO, NO EXISTE O NO TIENE UN PRECIO ASIGNADO</span>');$("#dMessages").effect("pulsate",3000)}$("#dpbtnAdd").addClass("hide");$("#dbtnAdd").removeClass("hide");$("#Proyectos").attr("readonly",false);$("#Anotaciones").attr("readonly",false);$("#Fecha").attr("readonly",false);$("#Numero").attr("readonly",false);$("#Etiqueta").attr("readonly",false);$("#Proveedores").attr("readonly",false);$("#Producto").attr("readonly",false);$("#Cantidad").attr("readonly",false)})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"FALTAN DATOS POR CAPTURAR"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});$(".btnAddRow").effect("shake");$("#dMessages").html('<span class="label label-danger"> ERROR! FALTAN DATOS POR CAPTURAR</span>');$("#dMessages").effect("pulsate",3000)}});$("#btnReport").click(function(){if(temp!==undefined&&temp>0){$("#btnReporting").removeClass("hide");$("#btnReport").addClass("hide");$.notify({title:'<span class="fa fa-cog fa-lg"></span>',message:"GENERANDO REPORTE..."},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});$.ajax({url:base_url+"index.php/ctrlCompras/getDataReportCotizacion",type:"POST",data:{ID:temp}}).done(function(h,i,g){console.log(h);console.log(i);console.log(g);console.log("EXITO");console.log(h);$("#msgCompras").html("DOCUMENTO GENERADO EN: <br>"+h);$("#btnReport").removeClass("hide");$("#btnReporting").addClass("hide");window.open(h,"_blank")}).fail(function(){console.log("ERROR GRAVE");console.log(arguments)})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"NO HA SELECCIONADO NINGUN REGISTRO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}});$("#dbtnAddU").click(function(g){g.preventDefault();if($("#UEtiqueta").val()!==undefined&&$("#UEtiqueta").val()!==""&&$("#UProducto").val()!==undefined&&$("#UProducto").val()!==""&&$("#UCantidad").val()!==undefined&&$("#UCantidad").val()!==""){$("#dpbtnAddU").removeClass("hide");$("#dbtnAddU").addClass("hide");$("#Anotaciones").attr("readonly",true);$("#UEtiqueta").attr("readonly",true);$("#UProveedores").attr("readonly",true);$("#UProducto").attr("readonly",true);$("#UCantidad").attr("readonly",true);$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:11,ID:$("#UProducto").val(),ETIQUETAID:$("#UEtiqueta").val(),PROVEEDORES:$("#UProveedores").val(),CANTIDAD:$("#UCantidad").val()}}).done(function(i,k,h){console.log(i);console.log(k);console.log(h);console.log(i);var j=i[0];if(j!==undefined){$(".tblCProductosU tbody").append('<tr class=""><td class="tdIDDETALLE hide">0</td><td class="tdIdPro hide">'+j.IDPROV+"</td><td>"+j.Proveedor+'</td><td class="tdIdProd hide">'+j.IDPROD+'</td><td class="tdIdEti hide">'+j.IDETI+"</td><td>"+j.Producto+" "+j.Marca+"</td><td>"+j.UnidadMedida+'</td><td class="tdCantidad"><input type="number" class="form-control" id="spCantidad" name="spCantidad" min="1" max="99999999" value="'+$("#UCantidad").val()+'" onchange="onRecalculate(this,this.value)" /></td><td class="tdPrecio hide">'+j.Precio+'</td><td class="text-center"><span class="label label-default">$ '+$.number(j.Precio,5,"."," ,")+'</span></td><td class="text-center tdImporteF"><span class="label label-warning">$ '+$.number(j.IMPORTE,5,".",", ")+'</span></td><td class="tdImporte hide">'+j.IMPORTE+'</td><td class="tdCantidadN hide">'+$("#UCantidad").val()+'</td><td><button type="button" class="btn btn3d btn-danger btn-lg btnDeleteRow" onclick="onDeleteRow(this,\'pnlTotalCotizacionUpdate\',\'pnlOCMessagesUpdate\')" data-toggle="tooltip" data-placement="top" title="" data-original-title="ELIMINAR" ><span class="fa fa-minus"></span></button> </td><td class="tdEstatus"><span class="label label-emerald">NUEVO</span></td></tr>');tt=tt+($("#UCantidad").val()*j.Precio);$("#pnlTotalCotizacionUpdate").effect("highlight",3000);$("#pnlTotalCotizacionUpdate").html('<div class="col-md-9"></div><span class="label label-default">TOTAL:</span><span class="label label-primary"> $ '+$.number(tt,5,".",", ")+"</span>");$("#pnlTotalCotizacionUpdate").append("<script> $(document).ready(function () {$('[data-toggle=\"tooltip\"]').tooltip();});<\/script>");onNotify('<span class="fa fa-check fa-lg"></span>',"PRODUCTO AGREGADO","success");$("#dMessagesU").html('<span class="label label-success">EXITO! PRODUCTO AGREGADO</span>');$("#dMessagesU").effect("pulsate",3000)}else{$("#dMessagesU").html('<span class="label label-danger">ERROR! EL PRODUCTO, NO EXISTE O NO TIENE UN PRECIO ASIGNADO</span>');$("#dMessagesU").effect("pulsate",3000)}$("#dpbtnAddU").addClass("hide");$("#dbtnAddU").removeClass("hide");$("#UAnotaciones").attr("readonly",false);$("#UEtiqueta").attr("readonly",false);$("#UProveedores").attr("readonly",false);$("#UProducto").attr("readonly",false);$("#UCantidad").attr("readonly",false)}).fail(function(){console.log("ERROR AL OBTENER LOS DATOS");console.log(arguments)})}else{onNotify('<span class="fa fa-exclamation fa-lg"></span>',"FALTAN DATOS POR CAPTURAR","danger");$("#UbtnAdd").effect("shake");$("#dMessagesU").html('<span class="label label-danger"> ERROR! FALTAN DATOS POR CAPTURAR</span>');$("#dMessagesU").effect("pulsate",3000)}});$("#btnRefresh").click(function(){onLoad()});$("#btnApproved").click(function(){if(temp!==undefined&&temp!==0&&temp>0){$("#btnApproved").find("span").removeClass("fa-check").addClass("fa-cog fa-spin");$("#btnApproved").addClass("disabled");$("#modal_title").html("CARGANDO...");$("#pnlHeadCotizacion").html("");$("#pnlResumenProgress").removeClass("hide");$("#tblCProductosResumen").parent().addClass("hide");$("#mdlDetalleOC").modal("toggle");$("#dResumen").html(temp);$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:8,ID:temp}}).done(function(j,k,h){console.log(j);console.log(k);console.log(h);tt=0;$("#pnlHeadCotizacion").html("");var g=jQuery.parseJSON(j.HEAD)[0];var i=jQuery.parseJSON(j.ROWS);if(g.ESTATUS==="APROBADA"){$("#btnApprovedMDL").addClass("hide")}else{$("#btnApprovedMDL").removeClass("hide")}$("#pnlResumenProgress").addClass("hide");$("#tblCProductosResumen").parent().removeClass("hide");$("#pnlHeadCotizacion").html("<h1>"+g.PROYECTO+'</h1><hr>\n                   <div class="col-md-12" align="left"><div class="col-md-1"></div><div class="col-md-11">\n<p class="text-muted">FECHA</p></div></div>\n<div class="col-md-2"></div><div class="col-md-10">\n<p class="text-justify">'+g.FECHA+'</p></div>\n<div class="col-md-12" align="left"><div class="col-md-1"></div><div class="col-md-11">\n<p class="text-muted">ANOTACIONES</p></div></div>\n<div class="col-md-2"></div><div class="col-md-10">\n<p class="text-justify">'+g.ANOTACIONES+'</p></div>\n<div class="col-md-12" align="left"><div class="col-md-1"></div><div class="col-md-11">\n<p class="text-muted">DETALLE</p></div></div>');$("#modal_title").html("DETALLE - COTIZACION "+g.NUMERO);$.each(i,function(l,m){$(".tblCProductosResumen tbody").append('<tr><td class="tdIdPro hide">'+m.IDPROV+"</td><td>"+m.Proveedor+'</td><td class="tdIdProd hide">'+m.IDPROD+'</td><td class="tdIdEti hide">'+m.IDETI+"</td><td>"+m.Producto+" "+m.Marca+"</td><td>"+m.UnidadMedida+'</td><td class="tdCantidad">'+m.CANTIDAD+'</td><td class="tdPrecio hide">'+m.Precio+'</td><td class="text-center"><span class="label label-default">$ '+$.number(m.Precio,5,"."," ,")+'</span></td><td class="text-center"><span class="label label-warning">$ '+$.number(m.IMPORTE,5,".",", ")+'</span></td><td class="tdImporte hide">'+m.IMPORTE+'</td><td class="hide"><button type="button" class="btn btn3d btn-danger btn-lg btnDeleteRow" onclick="onDeleteRow(this,\'pnlTotalCotizacion\',\'\')" data-toggle="tooltip" data-placement="top" title="" data-original-title="ELIMINAR" ><span class="fa fa-minus"></span></button> </td><td class="chksApproved text-center"><input type="checkbox" value="Seleccionado" name="chkRow" id="chkRow" class="form-control" onchange="onChangeRowApproved(this)"></td></tr>')});$("#pnlTotalCotizacion").html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>")}).fail(function(){console.log("Error al comprometer los datos")}).always(function(){$("#btnApproved").removeClass("disabled");$("#btnApproved").find("span").removeClass("fa-cog fa-spin").addClass("fa-check")})}else{onNotify('<span class="fa fa-exclamation fa-lg"></span>',"DEBE DE ELEGIR UN REGISTRO","danger")}});c.change(function(){if(a.val()!==""&&b.val()!==""&&c.val()!==""){$("#btnApprovedMDL").removeClass("disabled")}});$("#btnReportingOC").click(function(){onGenerarOrdenDeCompra()});$("#chkhHead").change(function(){tt=0;$("#tblCProductosResumen > tbody  > tr").each(function(g,h){$(this).each(function(j,i){var l=0;if($("#chkhHead")[0].checked){$(i).find("#chkRow")[0].checked=true;l=parseFloat($(i).find(".tdCantidad")[0].innerText)*parseFloat($(i).find(".tdPrecio")[0].innerText);tt=tt+l}else{tt=0;$(i).find("#chkRow")[0].checked=false}})});$("#pnlTotalCotizacion").html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>")});$("#btnApprovedMDL").click(function(){$("#btnApprovedMDL").find("span").removeClass("fa-check").addClass("fa-cog fa-spin");$("#btnApprovedMDL").addClass("disabled");$("#btnSaveCog").removeClass("hide");onAproved();setTimeout(function(){$("#btnApprovedMDL").removeClass("disabled");$("#btnApprovedMDL").find("span").removeClass("fa-cog fa-spin").addClass("fa-check")},2500)});$("#btnEdit").click(function(){if(temp!==undefined&&temp!==0&&temp>0){$("#modal_title_update").html("CARGANDO...");$("#pnlHeadCotizacionUpdate").addClass("hide");$("#pnlAddProductos").addClass("hide");$("#pnlResumenProgressUpdate").removeClass("hide");$("#tblCProductosU").parent().addClass("hide");$("#mdlUpdateOC").modal("toggle");$("#dResumen").html(temp);$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:8,ID:temp}}).done(function(j,k,h){console.log(j);console.log(k);console.log(h);tt=0;var g=jQuery.parseJSON(j.HEAD)[0];var i=jQuery.parseJSON(j.ROWS);$("#pnlResumenProgressUpdate").addClass("hide");$("#tblCProductosU").parent().removeClass("hide");$("h1.dtm_titulo_proy").text(g.PROYECTO);$("#UAnotaciones").val(g.ANOTACIONES);$("#UElabora").select2("val",g.ELABORA);$("p.dtm_fecha").text(g.FECHA);$("#USolicitante").val(g.SOLICITA);$("#USolicitante").select2("val",g.SOLICITA);$("#modal_title_update").html("EDITAR - COTIZACION "+g.NUMERO);$.each(i,function(l,m){tt+=m.CANTIDAD*m.Precio});console.log("Procesando...");$.each(i,function(l,m){$(".tblCProductosU tbody").append('<tr><td class="tdIDDETALLE hide">'+m.IDDETALLE+'</td><td class="tdIdPro hide">'+m.IDPROV+"</td><td>"+m.Proveedor+'</td><td class="tdIdProd hide">'+m.IDPROD+'</td><td class="tdIdEti hide">'+m.IDETI+"</td><td>"+m.Producto+" "+m.Marca+"</td><td>"+m.UnidadMedida+'</td><td class="tdCantidad"><input type="number" class="form-control" id="spCantidad" name="spCantidad" min="1" max="99999999" value="'+m.CANTIDAD+'" onchange="onRecalculate(this,this.value)" /></td><td class="tdPrecio hide">'+m.Precio+'</td><td class="text-center"><span class="label label-default">$ '+$.number(m.Precio,5,"."," ,")+'</span></td><td class="text-center tdImporteF"><span class="label label-warning">$ '+$.number(m.IMPORTE,5,".",", ")+'</span></td><td class="tdImporte hide">'+m.IMPORTE+'</td><td class="tdCantidadN hide">'+m.CANTIDAD+'</td><td><button type="button" class="btn btn3d btn-danger btn-lg" onclick="onDeleteRow(this,\'pnlTotalCotizacionUpdate\',\'pnlOCMessagesUpdate\')" data-toggle="tooltip" data-placement="top" title="" data-original-title="ELIMINAR" ><span class="fa fa-minus"></span></button> </td><td class="tdEstatus"><span class="label label-primary">GUARDADO</span></td></tr>')});$(".tblCProductosU tbody").on("click","tr",function(){$(".tblCProductosU").find("tr").removeClass("success");$(".tblCProductosU").find("tr").removeClass("warning");$(this).addClass("success")});$("#pnlTotalCotizacionUpdate").html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>");$("#dbtnAddU").removeClass("disabled");$("#pnlHeadCotizacionUpdate").removeClass("hide");$("#pnlAddProductos").removeClass("hide")}).fail(function(g,i,h){console.log(g,i,h);console.log("Error al comprometer los datos Y/O extraerlos")})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"DEBE DE ELEGIR UN REGISTRO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}});$("#btnCancel").click(function(){onCancelCompra();onLoad()});$("#btnUpdate").click(function(){if($("#tblCProductosU > tbody > tr").length>0){$("#btnUpdate").addClass("hide");$("#btnUpdateRefresh").removeClass("hide");onUpdate();setTimeout(function(){$("#btnUpdate").removeClass("hide");$("#btnUpdateRefresh").addClass("hide");$("#pnlOCMessagesUpdate").html('<span class="label label-success">EXITO! SE HAN GUARDADO LOS CAMBIOS</span>')},2500)}else{$("#pnlOCMessagesUpdate").html('<span class="label label-danger">ERROR! NO HA AGREGADO PRODUCTOS</span>');$("#pnlOCMessagesUpdate").effect("shake",1000)}});$("#Etiqueta").change(function(g){onChangeProductos("Proveedores","Producto","Etiqueta","ProductLoader","dMessages")});$("#UEtiqueta").change(function(g){onChangeProductos("UProveedores","UProducto","UEtiqueta","UProductLoader","dUMessages")});$("#btnSave").click(function(){$("#btnSave").addClass("disabled").find("span").removeClass("fa-save").addClass("fa-cog fa-spin");onSave();setTimeout(function(){$("#btnSave").removeClass("disabled").find("span").addClass("fa-save").removeClass("fa-cog fa-spin")},2500)});$("#btnCanceledRecords").click(function(){getData("tblComprasCanceladas",base_url+"index.php/ctrlCompras/onLoad",10,"rCompras","msgCompras","NO SE ENCONTRARON REGISTROS")});$("#mdlNuevoOC").on("hidden.bs.modal",function(){tt=0;$("#frmCotizacion")[0].reset();$("#frmCotizacion select").select2("val","");$("#tblCProductos > tbody  > tr").each(function(g,h){$(this).remove()});$("#frmCotizacionUpdate input").val("");$("#thTOTAL").effect("highlight",3000);$("#thTOTAL").html('<div class="col-md-9"></div><span class="label label-default">TOTAL:</span><span class="label label-primary"> $ 0.00</span>')});$("#mdlUpdateOC").on("hidden.bs.modal",function(){tt=0;$("#pnlOCMessagesUpdate").html("");$("#tblCProductosU > tbody  > tr").each(function(g,h){$(this).remove();console.log("borrando.."+g)});$("#pnlTotalCotizacionUpdate").effect("highlight",3000);$("#pnlTotalCotizacionUpdate").html("");$("#dbtnAddU").addClass("disabled");$("#frmCotizacionUpdate")[0].reset();$("#frmCotizacionUpdate input").val("");$("#frmCotizacionUpdate select").select2("val","")});$("#mdlDetalleOC").on("hidden.bs.modal",function(){tt=0;$("#tblCProductosResumen > tbody  > tr").each(function(g,h){$(this).remove()})});$("#mdlNuevoOC").on("hidden.bs.modal",function(){$("#mdlNuevoOC input").val("");$("#mdlNuevoOC select").select2("val","")});$("#Proyectos").change(function(g){if($("#Proyectos").val()!==""){$("#pnlOpciones").removeClass("hide");$("#collapse1").removeClass("in");$("#collapse2").toggleClass("in")}else{$("#pnlOpciones").toggleClass("hide");$("#collapse2").toggleClass("in")}})});function onOC(){}function onDeleteRow(f,b,a){var g=$(f).parent()[0].parentNode;target_total_value=tt;var d=$(g).find("td.tdImporte")[0].innerText;if(target_total_value>0){tt=target_total_value-d;console.log(b+""+tt);$("#"+b).html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>");$("#"+b).effect("highlight",3000);$("#"+b).html('<div class="col-md-9"></div><span class="label label-default">TOTAL:</span><span class="label label-primary"> $ '+$.number(tt,5,".",", ")+"</span>")}var c=$(f).parent()[0].parentNode;if($(c).find(".tdEstatus").find("span")[0].innerText==="GUARDADO"){$(c).find(".tdEstatus").find("span").removeClass("label-primary").addClass("label-danger");$(c).find(".tdEstatus").find("span")[0].innerText="ELIMINADO"}if($(c).find(".tdEstatus").find("span")[0].innerText==="NUEVO"){c.remove()}$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"REGISTRO ELIMINADO"},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});onNotify('<span class="fa fa-check fa-lg"></span>',"REGISTRO ELIMINADO","success");$("#"+a).html('<span class="label label-danger">¡¡¡¡¡REGISTRO ELIMINADO!!!!!</span>');$("#"+a).effect("pulsate",3000)}function onChangeProductos(c,b,g,a,f){var d=$("#"+c).val();if(d!==undefined&&d!==null&&d.length>0){$("#"+b).parent("div").addClass("hide");$("#"+a).removeClass("hide");$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:4,ID:$("#"+g).val(),PROVEEDORES:$("#"+c).val()},error:function(h,j,i){console.log(i);console.log(j)}}).done(function(j,k,i){if(j.length===0){$("#"+f).html('<span class="label label-danger">ERROR! EL PROVEEDOR SELECCIONADO NO TIENE PRODUCTOS EN ESTA CATEGORIA</span>');$("#"+f).effect("pulsate",3000);onNotify('<span class="fa fa-exclamation fa-lg"></span>',"EL PROVEEDOR SELECCIONADO NO TIENE PRODUCTOS EN ESTA CATEGORIA","danger")}else{$("#"+f).html('<span class="label label-success">EXITO! SE HAN ENCONTRADO PRODUCTOS EN ESTA CATEGORIA</span>');var h='<option value=""></option>';$.each(j,function(m,l){h=h+'<option value="'+l.ID+'">'+l.Producto+" "+l.Marca+"</option>"});$("#"+b).html(h);$("#"+a).addClass("hide");$("#"+b).parent("div").removeClass("hide")}})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"DEBE DE SELECCIONAR UN PROVEEDOR"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});$("#dMessages").html('<span class="label label-danger">ERROR! DEBE DE SELECCIONAR UN PROVEEDOR</span>');$("#Proveedores").val("")}}function onChangeProductosx(){$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:2,ID:$("#Producto").val()}}).done(function(c,d,b){console.log(c);console.log(d);console.log(b);var a='<option value=""></option>';$.each(c,function(g,f){a=a+'<option value="'+f.ID+'">'+f.Producto+" "+f.Marca+"</option>"});$("#Producto").html(a)})}function getFormatNumber(a){$.ajax({url:base_url+"index.php/ctrlResources/getFormatNumber",type:"POST",data:{NUMERO:a,NDECIMALES:2}}).done(function(c,d,b){console.log(c);console.log(d);console.log(b);nformat=c});return nformat}function onSave(){var b={PROYECTO:$("#Proyectos").val(),ELABORA:$("#Elabora").val(),SOLICITANTE:$("#Solicitante").val(),FECHA:$("#Fecha").val(),NUMERO:$("#Numero").val(),FACTURADO:$("#cmbFacturadoA").val(),ANOTACIONES:$("#Anotaciones").val(),ESTATUS:"SIN APROBAR"};var a=[];$("#tblCProductos > tbody  > tr").each(function(c,d){$(this).each(function(h,g){var f={IDPRO:$(g).find(".tdIdPro")[0].innerText,IDETI:$(g).find(".tdIdEti")[0].innerText,IDPROD:$(g).find(".tdIdProd")[0].innerText,CANTIDAD:$(g).find(".tdCantidad")[0].innerText,PRECIO:$(g).find(".tdPrecio")[0].innerText};a.push(f)})});$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",data:{indice:5,ENCABEZADO:b,DETALLE:a}}).done(function(d,f,c){console.log(d);console.log(f);console.log(c);console.log(d);if(parseInt(d)===1){$("#mdlNuevoOC").modal("hide");onLoad()}else{$("#dMessages").html('<span class="label label-danger">ERROR! NO SE HA PODIDO PROCESAR LA COTIZACION </span>')}})}function getData(c,b,d,f,a,g){$("#"+f).html('<div align="center"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div>');temp=0;$.ajax({url:b,type:"POST",dataType:"JSON",data:{indice:d},error:function(h,j,i){console.log(h.responseText);console.log(i);console.log(j)}}).done(function(k,l,j){var h=c;if(k.length>0){$("#"+f).html(getTable(h,k));var i=$("#"+h).DataTable(tableOptions);$("#"+h+" tbody").on("click","tr",function(){$("#"+h).find("tr").removeClass("success");$("#"+h).find("tr").removeClass("warning");var o=this.id;var m=$.inArray(o,selected);if(m===-1){selected.push(o)}else{selected.splice(m,1)}$(this).addClass("success");var n=i.row(this).data();temp=parseInt(n[0])});$("#"+h+" tbody").on("dblclick","tr",function(){$("#"+h).find("tr").removeClass("warning");$(this).addClass("warning");var m=i.row(this).data();temp=parseInt(m[0]);$("#btnEdit").trigger("click")});$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"LOS DATOS HAN SIDO ACTUALIZADOS"},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}else{$("#"+a).html('<div class="alert alert-dismissible alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><h1 class="text-center">'+g+"</h1></div>")}})}function format(a){console.log(a)}function onLoad(){$.ajax({url:base_url+"index.php/ctrlproveedor/getData",type:"POST",dataType:"JSON",success:function(b){var a='<option value=""></option>';if(b!==undefined){$.each(b,function(d,c){a=a+'<option value="'+c.ID+'">'+c.Proveedor+"</option>"});$("#Proveedores").html(a);$("#UProveedores").html(a)}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"LOS PROVEEDORES NO TIENEN PRECIOS ASIGNADOS O OCURRIO MIENTRAS SE OBTENIAN"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}});onGetFormasDePago();$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:13},success:function(b){var a='<option value=""></option>';if(b!==undefined){$.each(b,function(d,c){a=a+'<option value="'+c.ID+'">'+c.NombreC+"</option>"});$("#cmbFacturadoA").html(a)}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"LOS PROVEEDORES NO TIENEN PRECIOS ASIGNADOS O OCURRIO MIENTRAS SE OBTENIAN"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}});getData("tblCompras",base_url+"index.php/ctrlCompras/onLoad",6,"rCompras","msgCompras","NO SE ENCONTRARON REGISTROS");getUsuarios();getCuentas()}function onAproved(){HoldOn.open({theme:"sk-bounce",message:"ESPERE..."});console.log(temp);var a=[];var b=false;$("#tblCProductosResumen > tbody  > tr").each(function(c,d){$(this).each(function(h,g){if($(g).find("#chkRow")[0].checked){console.log("PRODUCTO SELECCIONADO: "+$(g).find(".tdIdProd")[0].innerText+", CON EL PROVEEDOR: "+$(g).find(".tdIdPro")[0].innerText+", CON PRECIO: "+$(g).find(".tdPrecio")[0].innerText);var f={IDPRO:$(g).find(".tdIdPro")[0].innerText,IDETI:$(g).find(".tdIdEti")[0].innerText,IDPROD:$(g).find(".tdIdProd")[0].innerText,CANTIDAD:$(g).find(".tdCantidad")[0].innerText,PRECIO:$(g).find(".tdPrecio")[0].innerText};a.push(f);b=true}else{console.log("PRODUCTO NO SELECCIONADO: "+$(g).find(".tdIdProd")[0].innerText+", CON EL PROVEEDOR: "+$(g).find(".tdIdPro")[0].innerText+", CON PRECIO: "+$(g).find(".tdPrecio")[0].innerText)}})});if(temp!==undefined&&temp!==null&&temp!==0&&temp>0&&b){$.ajax({url:base_url+"index.php/ctrlCompras/onApproved",type:"POST",data:{ID:temp,CONTRATO:$("#Contrato").val(),FORMADEPAGO:$("#cmbFormaDePago").val(),ENTREGA:$("#cmbLugarRecepcion").val(),AUTORIZA:$("#Autoriza").val(),RECIBE:$("#Recibe").val(),CUENTA:$("#Cuenta").val(),DETALLE:a}}).done(function(d,f,c){console.log(d);console.log(f);console.log(c);if(parseInt(d)===1){getData("tblCompras",base_url+"index.php/ctrlCompras/onLoad",6,"rCompras","msgCompras","NO SE ENCONTRARON REGISTROS");$("#mdlDetalleOC").modal("hide");HoldOn.close();$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"LA COTIZACION HA SIDO APROBADA"},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"LA COTIZACION NO HA SIDO APROBADA"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}).fail(function(){$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"ERROR! LA COTIZACION NO HA SIDO APROBADA, POR UN PROBLEMA EN EL SERVIDOR"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})})}else{$("#msgAprobacionDeCotizacion").html('<span class="label label-danger">DEBE DE SELECCIONAR UN REGISTRO</span>');$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"DEBE DE SELECCIONAR UN REGISTRO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}function onCancelCompra(){console.log(temp);if(temp!==undefined&&temp!==null&&temp!==0&&temp>0){$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",data:{indice:9,ID:temp}}).done(function(b,c,a){console.log(b);console.log(c);console.log(a);console.log(b);if(parseInt(b)===1){$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"EL REGISTRO "+temp+" HA SIDO CANCELADO"},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"EL REGISTRO "+temp+" NO HA SIDO CANCELADO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"DEBE DE SELECCIONAR UN REGISTRO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}function getLastID(){$("#pgrNCotizacion").removeClass("hide");$("#Numero").parent().addClass("hide");$.ajax({url:base_url+"index.php/ctrlCompras/onLoad",type:"POST",dataType:"JSON",data:{indice:7}}).done(function(c,f,b){console.log(c);console.log(f);console.log(b);var d="000000";if(c[0].MAXID!==null){var a=d.substring(0,d.length-c[0].MAXID.length)+(parseInt(c[0].MAXID)+1)}else{var a="000001"}$("#Numero").val(a);$("#pgrNCotizacion").addClass("hide");$("#Numero").parent().removeClass("hide");console.log(c)})}function onEnterCantidad(b,a){var c=$(e).find(".spCantidad")[0].value;$(e).find(".tdCantidad").html(c)}function onRecalculate(b,k){console.log(k===0,parseInt(k)===0);if(parseInt(k)===0){$(b).val(1);$("#pnlDetailCotizacionUpdate").find("p.text-info").effect("highlight",3000);$("#pnlDetailCotizacionUpdate").find("p.text-info").text("NO ES POSIBLE CAPTURAR VALORES EN 0")}var i=$(b).parent().parent()[0];var c=$(i)[0].innerHTML;var f=k;console.log($(c));var a=$(c)[8].innerHTML;var j=f*a;var h=$(i)[0];var g=$(h).find(".tdImporte")[0];var l=$(h).find(".tdImporteF")[0];var d=$(h).find(".tdCantidadN")[0];d.innerText=f;g.innerText=j;l.innerHTML=' <span class="label label-warning">$ '+$.number(j,5,".",", ")+"</span>";if(tt>0){tt=0}$.each($(".tblCProductosU tbody").find("tr").find(".tdImporte"),function(n,m){var o=0;o=parseFloat(m.innerText);tt=(tt+o);$("#pnlTotalCotizacionUpdate").html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>")})}function onUpdate(){var a={ID:$("#txtUID").val(),ELABORA:$("#UElabora").val(),SOLICITA:$("#USolicitante").val(),PROYECTO:$("#UProyectos").val(),NUMERO:$("#UNumero").val(),ANOTACIONES:$("#UAnotaciones").val()};var b=[];$("#tblCProductosU > tbody  > tr").each(function(c,d){$(this).each(function(g,f){var i={IDDET:$(f).find(".tdIDDETALLE")[0].innerText,IDPRO:$(f).find(".tdIdPro")[0].innerText,IDETI:$(f).find(".tdIdEti")[0].innerText,IDPROD:$(f).find(".tdIdProd")[0].innerText,CANTIDAD:$(f).find(".tdCantidadN")[0].innerText,PRECIO:$(f).find(".tdPrecio")[0].innerText,ESTATUS:$(f).find(".tdEstatus").find("span")[0].innerText};var h=$(f).find(".tdCantidadN")[0].innerText;console.log(h);b.push(i)})});console.log(a,b);$.ajax({url:base_url+"index.php/ctrlCompras/onUpdate",type:"POST",data:{ID:temp,ENCABEZADO:a,DETALLE:b}}).done(function(d,f,c){console.log(d);console.log(f);console.log(c);if(parseInt(d)===1){$("#mdlUpdateOC").modal("hide");onLoad()}else{$("#pnlOCMessagesUpdate").html('<span class="label label-danger">ERROR! NO SE HA PODIDO PROCESAR LA COTIZACION </span>')}})}function onGenerarOrdenDeCompra(){if(temp!==undefined&&temp!==null&&temp!==0&&temp>0){$("#btnReportingOC").addClass("disabled");$("#btnReportingOC").find("span").removeClass("fa-cart-arrow-down").addClass("fa-cog fa-spin");$.ajax({url:base_url+"index.php/ctrlCompras/onGenerarOrdenDeCompra",type:"POST",data:{ID:temp}}).done(function(b,c,a){console.log(b);console.log(c);console.log(a);$.notify({title:'<span class="fa fa-check fa-lg"></span>',message:"GENERANDO ORDEN DE COMPRA..."},{type:"success"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}});window.open(b,"_blank")}).fail(function(){console.log(arguments)}).always(function(){$("#btnReportingOC").removeClass("disabled");$("#btnReportingOC").find("span").removeClass("fa-cog fa-spin").addClass("fa-cart-arrow-down")})}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"DEBE DE SELECCIONAR UN REGISTRO"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}function onChangeRowApproved(d){var c=0;var f=$(d).parent().parent();var b=$(f).find(".tdPrecio")[0].innerText;var a=$(f).find(".tdCantidad")[0].innerText;var c=parseFloat($(f).find(".tdPrecio")[0].innerText)*parseFloat($(f).find(".tdCantidad")[0].innerText);console.log(c,parseFloat(c).toFixed(2));console.log($(d)[0].checked);if($(d)[0].checked){tt=tt+c}else{tt=tt-c}$("#pnlTotalCotizacion").html('<span class="label label-default">TOTAL:</span><span class="label label-primary">$ '+$.number(tt,5,".",", ")+"</span>")}function onGetFormasDePago(){$.ajax({url:base_url+"index.php/ctrlCompras/getFormaDePago",type:"POST",dataType:"JSON",success:function(b){var a='<option value=""></option>';if(b!==undefined){$.each(b,function(d,c){a=a+'<option value="'+c.ID+'">'+c.FORMADEPAGO+"</option>"});$("#cmbFormaDePago").html(a)}else{$.notify({title:'<span class="fa fa-exclamation fa-lg"></span>',message:"LOS PROVEEDORES NO TIENEN PRECIOS ASIGNADOS O OCURRIO MIENTRAS SE OBTENIAN"},{type:"danger"},{animate:{enter:"animated bounceIn",exit:"animated bounceOut"}})}}})}function getUsuarios(){$.ajax({url:base_url+"index.php/ctrlCompras/getUsuarios",type:"POST",dataType:"JSON",success:function(b){var a='<option value=""></option>';if(b!==undefined){$.each(b,function(d,c){a=a+'<option value="'+c.Id+'">'+c.nombre+" "+c.apaterno+" "+c.amaterno+"</option>"});$("#Elabora").html(a);$("#UElabora").html(a);$("#Solicitante").html(a);$("#USolicitante").html(a);$("#Autoriza").html(a)}else{onNotify('<span class="fa fa-exclamation fa-lg"></span>',"NO SÉ ENCONTRARON REGISTROS DE USUARIOS","danger")}},error:function(a,c,b){console.log(a,c,b)}})}function getCuentas(){$.ajax({url:base_url+"index.php/ctrlCompras/getCuentas",type:"POST",dataType:"JSON",success:function(b){var a='<option value=""></option>';if(b!==undefined){$.each(b,function(d,c){a=a+'<option value="'+c.ID+'">'+c.CUENTA+"</option>"});$("#Cuenta").html(a)}else{onNotify('<span class="fa fa-exclamation fa-lg"></span>',"NO SÉ ENCONTRARON CUENTAS","danger")}},error:function(a,c,b){console.log(a,c,b)}})};